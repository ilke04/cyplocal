<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - CypLocal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .bg-custom { background-color: #648DDB; }
        .text-custom { color: #648DDB; }
        .nav-link.active { background-color: #648DDB; color: white; }
    </style>
</head>
<body class="bg-gray-50 flex">
    <div class="w-64 h-screen bg-slate-800 text-white p-5 fixed flex flex-col shadow-2xl">
        <div class="mb-10 text-center border-b border-slate-700 pb-5">
            <img src="logo.png" alt="Logo" class="h-24 mx-auto mb-2 object-contain">
            <p class="text-[10px] text-slate-400 font-bold tracking-[2px]">TRNC COMMUNITY EVENTS</p>
        </div>
       
        <nav class="space-y-2 flex-1">
            <button onclick="showSection('overview')" id="btn-overview" class="nav-link w-full text-left p-4 rounded-2xl transition flex items-center active">
                <i class="fas fa-th-large mr-2"></i> Dashboard
            </button>
            <button onclick="showSection('events')" id="btn-events" class="nav-link w-full text-left p-4 text-slate-400 hover:bg-slate-700 rounded-2xl transition flex items-center">
                <i class="fas fa-calendar-alt mr-2"></i> Event List
            </button>
            <button onclick="showSection('users')" id="btn-users" class="nav-link w-full text-left p-4 text-slate-400 hover:bg-slate-700 rounded-2xl transition flex items-center">
                <i class="fas fa-users mr-2"></i> Mobile Users
            </button>
            <button onclick="showSection('analytics')" id="btn-analytics" class="nav-link w-full text-left p-4 text-slate-400 hover:bg-slate-700 rounded-2xl transition flex items-center">
                <i class="fas fa-chart-pie mr-2"></i> Analytics
            </button>
            <button onclick="showSection('notifications')" id="btn-notifications" class="nav-link w-full text-left p-4 text-slate-400 hover:bg-slate-700 rounded-2xl transition flex items-center">
                <i class="fas fa-bell mr-2"></i> Notifications
            </button>
        </nav>
        <a href="#" onclick="logout()" class="block p-4 text-red-400 font-bold border-t border-slate-700 pt-5 hover:bg-red-900/10 rounded-2xl transition">
            <i class="fas fa-sign-out-alt mr-2"></i> Logout
        </a>
    </div>
    <div class="flex-1 ml-64 p-10">
       
        <div class="flex justify-between items-center mb-10 bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
            <div>
                <h1 id="mainTitle" class="text-3xl font-black text-slate-800 tracking-tighter uppercase italic">Control Panel</h1>
                <div class="flex items-center mt-1">
                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></span>
                    <span id="muniDisplay" class="text-custom font-black text-sm uppercase tracking-widest"></span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="text-xs font-bold text-gray-400 uppercase">Logged in as</p>
                    <p class="text-slate-700 font-black">admin@test.com</p>
                </div>
                <div class="w-14 h-14 bg-custom rounded-2xl flex items-center justify-center text-white text-xl font-bold shadow-lg">AD</div>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div id="sec-overview" class="content-section">
            <div class="grid grid-cols-3 gap-8 mb-10">
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 flex items-center justify-between">
                    <div><p class="text-gray-400 font-bold uppercase text-xs tracking-widest mb-1">Total Mobile Users</p><h3 id="mobileUserCount" class="text-5xl font-black text-slate-800 tracking-tighter">20</h3></div>
                    <div class="bg-blue-50 p-5 rounded-2xl text-custom text-3xl shadow-inner"><i class="fas fa-users"></i></div>
                </div>
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 flex items-center justify-between">
                    <div><p class="text-gray-400 font-bold uppercase text-xs tracking-widest mb-1">Total Admins</p><h3 id="adminCount" class="text-5xl font-black text-slate-800 tracking-tighter">2</h3></div>
                    <div class="bg-purple-50 p-5 rounded-2xl text-purple-400 text-3xl shadow-inner"><i class="fas fa-user-shield"></i></div>
                </div>
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 flex items-center justify-between">
                    <div><p class="text-gray-400 font-bold uppercase text-xs tracking-widest mb-1">Total Events</p><h3 id="eventCount" class="text-5xl font-black text-slate-800 tracking-tighter">9</h3></div>
                    <div class="bg-indigo-50 p-5 rounded-2xl text-indigo-400 text-3xl shadow-inner"><i class="fas fa-calendar-alt"></i></div>
                </div>
            </div>

            <!-- System Users Table on Dashboard -->
            <div class="bg-white rounded-[2rem] shadow-xl border border-gray-100 overflow-hidden mb-10">
                <div class="p-8 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                    <h3 class="text-xl font-black text-slate-800 tracking-tight">System Users</h3>
                    <button onclick="openAddSystemUserModal()" class="bg-custom text-white px-6 py-2 rounded-xl font-bold text-sm">+ Add New User</button>
                </div>
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-gray-400 text-[10px] uppercase font-black tracking-[2px]">
                        <tr><th class="p-6">Full Name</th><th class="p-6">Email Address</th><th class="p-6">Municipality</th><th class="p-6">Access Level</th><th class="p-6 text-center">Actions</th></tr>
                    </thead>
                    <tbody id="systemUsersTable" class="divide-y divide-gray-50 font-medium">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- EVENTS SECTION -->
        <div id="sec-events" class="content-section hidden">
            <div class="bg-white rounded-[2rem] shadow-xl border border-gray-100 overflow-hidden">
                <div class="p-8 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                    <h3 class="text-xl font-black text-slate-800 tracking-tight">Event Management</h3>
                    <button onclick="openAddEventModal()" class="bg-custom text-white px-6 py-2 rounded-xl font-bold text-sm">+ Add New Event</button>
                </div>

                <!-- Tabs -->
                <div class="flex border-b border-gray-100">
                    <button onclick="filterEvents('all')" id="tab-all" class="px-8 py-4 font-bold text-custom border-b-4 border-custom">All Events</button>
                    <button onclick="filterEvents('past')" id="tab-past" class="px-8 py-4 font-bold text-gray-500 hover:text-custom">Past Events</button>
                    <button onclick="filterEvents('today')" id="tab-today" class="px-8 py-4 font-bold text-gray-500 hover:text-custom">Today's Events</button>
                    <button onclick="filterEvents('upcoming')" id="tab-upcoming" class="px-8 py-4 font-bold text-gray-500 hover:text-custom">Upcoming Events</button>
                </div>

                <div id="eventsList" class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Events injected by JS -->
                </div>
            </div>
        </div>

        <!-- MOBILE USERS SECTION -->
        <div id="sec-users" class="content-section hidden">
            <div class="bg-white rounded-[2rem] shadow-xl border border-gray-100 overflow-hidden">
                <div class="p-8 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                    <h3 class="text-xl font-black text-slate-800 tracking-tight">Mobile App Users</h3>
                </div>
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-gray-400 text-[10px] uppercase font-black tracking-[2px]">
                        <tr><th class="p-6">Full Name</th><th class="p-6">Phone</th><th class="p-6">Email Address</th><th class="p-6">Registration Date</th><th class="p-6 text-center">Actions</th></tr>
                    </thead>
                    <tbody id="mobileUsersTable" class="divide-y divide-gray-50 font-medium">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
                <div id="mobilePagination" class="p-4 flex justify-center space-x-4"></div>
            </div>
        </div>

        <!-- ANALYTICS -->
        <div id="sec-analytics" class="content-section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-10 rounded-[2rem] shadow-sm border border-gray-100">
                    <h3 class="text-xl font-black mb-8 italic text-slate-800">User Growth (Last 6 Months)</h3>
                    <canvas id="growthChart"></canvas>
                </div>
                <div class="bg-white p-10 rounded-[2rem] shadow-sm border border-gray-100">
                    <h3 class="text-xl font-black mb-8 italic text-slate-800">Engagement Metrics</h3>
                    <div class="space-y-8">
                        <div>
                            <div class="flex justify-between text-sm font-bold mb-2"><span>User Engagement Rate</span><span>85%</span></div>
                            <div class="w-full bg-gray-100 h-4 rounded-full"><div class="bg-custom h-4 rounded-full" style="width: 85%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm font-bold mb-2"><span>Event Attendance Rate</span><span>72%</span></div>
                            <div class="w-full bg-gray-100 h-4 rounded-full"><div class="bg-green-500 h-4 rounded-full" style="width: 72%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm font-bold mb-2"><span>Notification Open Rate</span><span>91%</span></div>
                            <div class="w-full bg-gray-100 h-4 rounded-full"><div class="bg-purple-500 h-4 rounded-full" style="width: 91%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm font-bold mb-2"><span>App Retention</span><span>68%</span></div>
                            <div class="w-full bg-gray-100 h-4 rounded-full"><div class="bg-orange-500 h-4 rounded-full" style="width: 68%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOTIFICATIONS -->
        <div id="sec-notifications" class="content-section hidden">
            <div class="bg-white p-10 rounded-[2rem] shadow-sm border border-gray-100 text-center">
                <div class="w-20 h-20 bg-blue-50 text-custom rounded-full flex items-center justify-center mx-auto mb-6 text-3xl">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <h3 class="text-2xl font-black mb-4">Broadcast Notification</h3>
                <input type="text" id="notifMsg" placeholder="Enter message for mobile users..." class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-blue-100 font-medium">
                <button onclick="sendNotif()" id="btnSend" class="w-full bg-custom text-white py-4 rounded-2xl font-black shadow-lg hover:brightness-105">SEND TO MOBILE APP USERS</button>
                <p id="sendAlert" class="mt-4 text-green-500 font-bold hidden italic animate-pulse text-sm">Push notification sent successfully!</p>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="addEventModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-8 w-full max-w-2xl overflow-y-auto max-h-screen">
            <h3 class="text-2xl font-black mb-6">Add New Event</h3>
            <input id="eventName" type="text" placeholder="Event Name (e.g. Cansever Concert)" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <select id="eventCategory" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
                <option value="Concert">Concert</option>
                <option value="Theatre">Theatre</option>
                <option value="Workshop">Workshop</option>
                <option value="Sports">Sports Event / Match Viewing</option>
                <option value="Other">Other</option>
            </select>
            <input id="eventDate" type="date" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <input id="eventTime" type="time" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <input id="eventLocation" type="text" placeholder="Event Location (e.g. Salamis Ancient Theatre, Othello Castle)" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <textarea id="eventDetails" placeholder="Event Details" class="w-full p-4 border border-gray-200 rounded-2xl mb-4 h-32"></textarea>
            <input id="eventImage" type="text" placeholder="Image URL (optional)" class="w-full p-4 border border-gray-200 rounded-2xl mb-6">
            <div class="flex justify-end space-x-4">
                <button onclick="closeAddEventModal()" class="px-6 py-3 border border-gray-300 rounded-xl font-bold">Cancel</button>
                <button onclick="addEvent()" class="px-6 py-3 bg-custom text-white rounded-xl font-bold">Add Event</button>
            </div>
        </div>
    </div>

    <!-- Add System User Modal -->
    <div id="addSystemUserModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-8 w-full max-w-md">
            <h3 class="text-2xl font-black mb-6">Add System User</h3>
            <input id="newUserName" type="text" placeholder="Full Name" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <input id="newUserEmail" type="email" placeholder="Email" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
            <select id="newUserMuni" class="w-full p-4 border border-gray-200 rounded-2xl mb-4">
                <option value="Famagusta">Famagusta</option>
                <option value="Kyrenia">Kyrenia</option>
                <option value="Nicosia">Nicosia</option>
                <option value="All">All Municipalities (Admin)</option>
            </select>
            <select id="newUserRole" class="w-full p-4 border border-gray-200 rounded-2xl mb-6">
                <option value="Admin">Admin</option>
                <option value="Staff">Staff</option>
            </select>
            <div class="flex justify-end space-x-4">
                <button onclick="closeAddSystemUserModal()" class="px-6 py-3 border border-gray-300 rounded-xl font-bold">Cancel</button>
                <button onclick="addSystemUser()" class="px-6 py-3 bg-custom text-white rounded-xl font-bold">Add User</button>
            </div>
        </div>
    </div>

    <script>
        const TODAY = new Date('2025-12-27');

        const savedMuni = localStorage.getItem('userMuni') || 'Famagusta';
        if(!localStorage.getItem('userMuni')) window.location.href = 'index.html';
        document.getElementById('muniDisplay').innerText = "Active: " + savedMuni + " Municipality";

        let events = [
    {id:1, name:"Summer Music Fest - Buray Concert", date:"2025-07-15", time:"20:00", details:"Popular Turkish singer Buray live in Famagusta", price:"Free", category:"Concert", location:"Salamis Ancient Theatre",
     image:"https://www.emu.edu.tr/media/posts_media/media_1102_en_1200.jpg?1584889156"},
    {id:2, name:"Romeo & Juliet Theatre Play", date:"2025-08-22", time:"19:30", details:"Classic Shakespeare performance", price:"50 TL", category:"Theatre", location:"Famagusta Municipal Theatre",
     image:"https://cdn.svvoice.com/wp-content/uploads/2019/06/18020648/3-Balcony-credit-Jay-Yamada-Copy.jpg"},
    {id:3, name:"Photography Workshop", date:"2025-06-10", time:"14:00", details:"Beginner to advanced photography techniques", price:"100 TL", category:"Workshop", location:"Famagusta Cultural Center",
     image:"https://media.istockphoto.com/id/1462034337/photo/photographer-teaching-students-about-camera-equipment-in-his-studio.jpg?s=612x612&w=0&k=20&c=HbSIrrXoSQzrG6fQ8o7P8I3El3ZuDiydASWX_i1UkEg="},
    {id:4, name:"Teoman Concert", date:"2025-12-20", time:"21:00", details:"Rock legend Teoman live", price:"Free", category:"Concert", location:"Palm Beach Area",
     image:"https://www.emu.edu.tr/media/posts_media/media_1519_en_1200.jpg?1584889164"},
    {id:5, name:"Fenerbahçe vs Galatasaray Match Viewing", date:"2025-12-27", time:"20:00", details:"Big derby match live on giant screen", price:"Free", category:"Sports", location:"City Square",
     image:"https://platform.sbnation.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/13890049/Gala_Fans.1419963559.jpg?quality=90&strip=all&crop=0,0.04541326067212,100,99.909173478656"},
    {id:6, name:"Christmas Jazz Night - Kerem Görsev Trio", date:"2025-12-27", time:"21:30", details:"Special holiday jazz performance", price:"Free", category:"Concert", location:"Othello Castle",
     image:"https://m.media-amazon.com/images/S/pv-target-images/d38c944bffd6e32bd6a12d6f6c8d6f370912fb90a4529e69e689e8dc798a5b16._SX1080_FMjpg_.jpg"},
    {id:7, name:"New Year's Eve Concert - Sıla", date:"2025-12-31", time:"22:00", details:"Amazing New Year celebration with Sıla", price:"Free", category:"Concert", location:"Salamis Ruins",
     image:"https://egesaaticomtr.teimg.com/crop/1280x720/egesaati-com-tr/wp/uploads/2025/02/ekspres-manset-olcu-2024-04-24t131852029.webp"},
    {id:8, name:"Digital Painting Workshop", date:"2026-01-10", time:"15:00", details:"Learn digital art with tablets", price:"120 TL", category:"Workshop", location:"Gazimağusa Art Center",
     image:"https://images.stockcake.com/public/f/1/0/f1038d9c-d3e2-4095-b8a1-79a69462efeb_large/artist-creating-digital-stockcake.jpg"},
    {id:9, name:"Children's Theatre - Pinocchio", date:"2026-01-05", time:"15:00", details:"Fun family theatre show for kids", price:"30 TL", category:"Theatre", location:"Famagusta Municipal Theatre",
     image:"https://www.hollywoodreporter.com/wp-content/uploads/2017/12/a_scene_from_pinocchio_centre_joe_idris-roberts_pinocchio-h_2017.jpg?w=1296&h=730&crop=1"}
];
        

        let systemUsers = [
            {name:"Connor Storrie", email:"connor@cyplocal.com", municipality:"All", role:"Admin", active: true},
            {name:"Hudson Williams", email:"hudson@cyplocal.com", municipality:"Famagusta", role:"Staff", active: true},
            {name:"Maria Georgiou", email:"maria@cyplocal.com", municipality:"Kyrenia", role:"Staff", active: true},
            {name:"Ahmet Yılmaz", email:"ahmet@cyplocal.com", municipality:"Nicosia", role:"Staff", active: true},
            {name:"Elena Papadopoulou", email:"elena@cyplocal.com", municipality:"All", role:"Admin", active: true}
        ];

        let mobileUsers = [
            {name: "John Doe", phone: "+905331234567", email: "john.doe@example.com", regDate: "2024-01-15"},
            {name: "Jane Smith", phone: "+905331234568", email: "jane.smith@example.com", regDate: "2024-02-20"},
            {name: "Alice Johnson", phone: "+905331234569", email: "alice.johnson@example.com", regDate: "2024-03-10"},
            {name: "Bob Brown", phone: "+905331234570", email: "bob.brown@example.com", regDate: "2024-04-05"},
            {name: "Charlie Davis", phone: "+905331234571", email: "charlie.davis@example.com", regDate: "2024-05-12"},
            {name: "David Evans", phone: "+905331234572", email: "david.evans@example.com", regDate: "2024-06-18"},
            {name: "Eve Foster", phone: "+905331234573", email: "eve.foster@example.com", regDate: "2024-07-22"},
            {name: "Frank Green", phone: "+905331234574", email: "frank.green@example.com", regDate: "2024-08-30"},
            {name: "Grace Harris", phone: "+905331234575", email: "grace.harris@example.com", regDate: "2024-09-14"},
            {name: "Henry Irving", phone: "+905331234576", email: "henry.irving@example.com", regDate: "2024-10-25"},
            {name: "Ivy Jackson", phone: "+905331234577", email: "ivy.jackson@example.com", regDate: "2024-11-03"},
            {name: "Jack King", phone: "+905331234578", email: "jack.king@example.com", regDate: "2024-12-07"},
            {name: "Karen Lee", phone: "+905331234579", email: "karen.lee@example.com", regDate: "2025-01-11"},
            {name: "Larry Miller", phone: "+905331234580", email: "larry.miller@example.com", regDate: "2025-02-16"},
            {name: "Mia Nelson", phone: "+905331234581", email: "mia.nelson@example.com", regDate: "2025-03-21"},
            {name: "Nathan Oliver", phone: "+905331234582", email: "nathan.oliver@example.com", regDate: "2025-04-26"},
            {name: "Olivia Parker", phone: "+905331234583", email: "olivia.parker@example.com", regDate: "2025-05-30"},
            {name: "Paul Quinn", phone: "+905331234584", email: "paul.quinn@example.com", regDate: "2025-06-04"},
            {name: "Quinn Roberts", phone: "+905331234585", email: "quinn.roberts@example.com", regDate: "2025-07-09"},
            {name: "Rachel Scott", phone: "+905331234586", email: "rachel.scott@example.com", regDate: "2025-08-13"}
        ];

        let currentMobilePage = 1;
        const itemsPerPage = 10;

        function updateCounts() {
            document.getElementById('eventCount').innerText = events.length;
            document.getElementById('adminCount').innerText = systemUsers.filter(u => u.role === 'Admin').length;
            document.getElementById('mobileUserCount').innerText = mobileUsers.length;
        }

        function renderEvents(filter = 'all') {
            const container = document.getElementById('eventsList');
            container.innerHTML = '';

            let filtered = events.slice();
            if(filter === 'past') filtered = events.filter(e => new Date(e.date) < TODAY);
            if(filter === 'today') filtered = events.filter(e => new Date(e.date).toDateString() === TODAY.toDateString());
            if(filter === 'upcoming') filtered = events.filter(e => new Date(e.date) > TODAY);

            filtered.sort((a,b) => new Date(b.date) - new Date(a.date));

            filtered.forEach(event => {
                const card = document.createElement('div');
                card.className = 'bg-slate-50 rounded-2xl border border-slate-100 overflow-hidden';
                card.innerHTML = `
                    ${event.image ? `<img src="${event.image}" class="w-full h-48 object-cover">` : '<div class="w-full h-48 bg-gray-200 flex items-center justify-center"><i class="fas fa-image text-4xl text-gray-400"></i></div>'}
                    <div class="p-6">
                        <span class="text-xs font-black uppercase text-custom">${event.category}</span>
                        <h4 class="font-bold text-lg mt-1">${event.name}</h4>
                        <p class="text-sm text-gray-500 mt-1">${event.date.replace(/-/g,'/')} • ${event.time} • ${event.location}</p>
                        <p class="text-sm text-gray-600 mt-2">${event.details}</p>
                        <p class="font-bold text-custom mt-3">${event.price} • Hosted by Municipality</p>
                        <button onclick="deleteEvent(${event.id})" class="mt-4 text-red-500 text-sm font-bold hover:underline">Remove Event</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function deleteEvent(id) {
            if(confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== id);
                renderEvents(document.querySelector('#sec-events .border-b-4.border-custom')?.parentElement?.onclick?.toString()?.match(/'(\w+)'/)?.[1] || 'all');
                updateCounts();
            }
        }

        function addEvent() {
            const name = document.getElementById('eventName').value;
            const category = document.getElementById('eventCategory').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value || "19:00";
            const location = document.getElementById('eventLocation').value || "Famagusta";
            const details = document.getElementById('eventDetails').value;
            const image = document.getElementById('eventImage').value;

            if(!name || !date) return alert('Event name and date are required!');

            const price = (category === "Workshop" || category === "Theatre") ? "Paid Entry" : "Free";

            const newEvent = {
                id: Date.now(),
                name, category, date, time, details,
                price,
                image
            };
            events.unshift(newEvent);
            closeAddEventModal();
            renderEvents('all');
            updateCounts();
        }

        function openAddEventModal() { document.getElementById('addEventModal').classList.remove('hidden'); document.getElementById('addEventModal').classList.add('flex'); }
        function closeAddEventModal() { document.getElementById('addEventModal').classList.add('hidden'); document.getElementById('addEventModal').classList.remove('flex'); }

        function renderSystemUsers() {
            const table = document.getElementById('systemUsersTable');
            table.innerHTML = '';

            systemUsers.forEach((user, idx) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-blue-50/30 transition';
                tr.innerHTML = `
                    <td class="p-6 text-slate-700 font-bold">${user.name}</td>
                    <td class="p-6 text-gray-500 italic">${user.email}</td>
                    <td class="p-6 text-gray-700">${user.municipality === 'All' ? '<span class="text-custom font-bold">All Municipalities</span>' : user.municipality}</td>
                    <td class="p-6"><span class="px-4 py-1 rounded-full text-[10px] font-black uppercase ${user.role==='Admin'?'bg-blue-100 text-blue-600':'bg-green-100 text-green-600'}">${user.role}</span></td>
                    <td class="p-6 text-center">
                        <button onclick="toggleUserActive(${idx})" class="text-sm font-bold ${user.active ? 'text-green-600' : 'text-gray-400'} mr-4">
                            ${user.active ? 'Active' : 'Inactive'}
                        </button>
                        <button onclick="deleteSystemUser(${idx})" class="text-red-400 underline font-black uppercase text-xs">Remove</button>
                    </td>
                `;
                table.appendChild(tr);
            });
        }

        function toggleUserActive(idx) {
            systemUsers[idx].active = !systemUsers[idx].active;
            renderSystemUsers();
        }

        function deleteSystemUser(idx) {
            if(confirm('Remove this system user?')) {
                systemUsers.splice(idx,1);
                renderSystemUsers();
                updateCounts();
            }
        }

        function addSystemUser() {
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const municipality = document.getElementById('newUserMuni').value;
            const role = document.getElementById('newUserRole').value;
            if(!name || !email) return alert('Name and email required!');
            systemUsers.push({name, email, municipality, role, active: true});
            closeAddSystemUserModal();
            renderSystemUsers();
            updateCounts();
        }

        function openAddSystemUserModal() { document.getElementById('addSystemUserModal').classList.remove('hidden'); document.getElementById('addSystemUserModal').classList.add('flex'); }
        function closeAddSystemUserModal() { document.getElementById('addSystemUserModal').classList.add('hidden'); document.getElementById('addSystemUserModal').classList.remove('flex'); }

        function renderMobileUsers(page = 1) {
            currentMobilePage = page;
            const table = document.getElementById('mobileUsersTable');
            table.innerHTML = '';
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginated = mobileUsers.slice(start, end);

            paginated.forEach((user, i) => {
                const globalIdx = start + i;
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-blue-50/30 transition';
                tr.innerHTML = `
                    <td class="p-6 text-slate-700 font-bold">${user.name}</td>
                    <td class="p-6 text-gray-500">${user.phone}</td>
                    <td class="p-6 text-gray-500 italic">${user.email}</td>
                    <td class="p-6 text-gray-700">${user.regDate}</td>
                    <td class="p-6 text-center">
                        <button onclick="deleteMobileUser(${globalIdx})" class="text-red-400 underline font-black uppercase text-xs">Remove</button>
                    </td>
                `;
                table.appendChild(tr);
            });

            const pagination = document.getElementById('mobilePagination');
            pagination.innerHTML = '';
            const totalPages = Math.ceil(mobileUsers.length / itemsPerPage);

            if (page > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'px-4 py-2 bg-gray-200 rounded-xl font-bold text-sm hover:bg-gray-300';
                prevBtn.innerText = 'Previous';
                prevBtn.onclick = () => renderMobileUsers(page - 1);
                pagination.appendChild(prevBtn);
            }

            if (page < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'px-4 py-2 bg-gray-200 rounded-xl font-bold text-sm hover:bg-gray-300';
                nextBtn.innerText = 'Next';
                nextBtn.onclick = () => renderMobileUsers(page + 1);
                pagination.appendChild(nextBtn);
            }
        }

        function deleteMobileUser(idx) {
            if (confirm('Remove this mobile user?')) {
                mobileUsers.splice(idx, 1);
                let totalPages = Math.ceil(mobileUsers.length / itemsPerPage);
                if (currentMobilePage > totalPages) currentMobilePage = totalPages;
                renderMobileUsers(currentMobilePage);
                updateCounts();
            }
        }

        function filterEvents(type) {
            document.querySelectorAll('#sec-events button').forEach(btn => {
                btn.classList.remove('text-custom', 'border-custom');
                btn.classList.add('text-gray-500');
            });
            document.getElementById('tab-'+type).classList.add('text-custom', 'border-custom');
            document.getElementById('tab-'+type).classList.remove('text-gray-500');
            renderEvents(type);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('sec-' + sectionId).classList.remove('hidden');

            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.remove('active', 'bg-custom', 'text-white');
                btn.classList.add('text-slate-400');
            });
            document.getElementById('btn-' + sectionId).classList.add('active', 'bg-custom', 'text-white');
            document.getElementById('btn-' + sectionId).classList.remove('text-slate-400');

            const titles = { overview: 'Control Panel', users: 'Mobile Users', events: 'Event List', analytics: 'Data Analytics', notifications: 'Push Notifications' };
            document.getElementById('mainTitle').innerText = titles[sectionId];

            if(sectionId === 'events') filterEvents('all');
            if(sectionId === 'analytics') renderCharts();
            if(sectionId === 'users') renderMobileUsers(1);
        }

        function renderCharts() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'New Users',
                        data: [45, 68, 92, 110, 135, 168],
                        backgroundColor: '#648DDB',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function sendNotif() {
            const msg = document.getElementById('notifMsg').value;
            if(!msg) return alert("Please enter a message!");
            const btn = document.getElementById('btnSend');
            btn.innerText = "SENDING BROADCAST...";
            btn.disabled = true;
            setTimeout(() => {
                btn.innerText = "BROADCAST COMPLETE!";
                btn.classList.replace('bg-custom', 'bg-green-500');
                document.getElementById('sendAlert').classList.remove('hidden');
                setTimeout(() => {
                    btn.innerText = "SEND TO MOBILE APP USERS";
                    btn.classList.replace('bg-green-500', 'bg-custom');
                    btn.disabled = false;
                    document.getElementById('sendAlert').classList.add('hidden');
                    document.getElementById('notifMsg').value = "";
                }, 3000);
            }, 1500);
        }

        function logout() {
            localStorage.removeItem('userMuni');
            window.location.href = 'index.html';
        }

        updateCounts();
        renderSystemUsers();
        renderEvents('all');
        filterEvents('all');
        renderMobileUsers(1);
    </script>
</body>
</html>